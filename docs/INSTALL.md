# å®‰è£…è¯´æ˜

> ä¸­æ–‡éƒ½æ²¡æœ‰æè½¬ï¼Œå°±ä¸å†™è‹±æ–‡æ–‡æ¡£äº†ï¼Œå®³äººå®³å·±ï¼Œå“ˆå“ˆğŸ˜„ã€‚

## ä¾èµ–ç¨‹åº

- go 1.13+ [å®‰è£…æ•™ç¨‹](https://www.runoob.com/go/go-environment.html)
- nodejs (npm,vue) [å®‰è£…æ•™ç¨‹](https://www.runoob.com/nodejs/nodejs-install-setup.html)
- go-bindata [æ•™ç¨‹](https://github.com/shuLhan/go-bindata)
- make (éå¿…é¡»)

æ³¨ï¼šå¦‚æœä¸æ˜ç™½å¦‚ä½•å®‰è£…çš„åŒå­¦ï¼Œè¯·è‡ªè¡ŒGoogleæˆ–ç™¾åº¦ã€‚

## å®‰è£…

### äºŒè¿›åˆ¶å®‰è£…

[ä¸‹è½½äºŒè¿›åˆ¶åŒ…](https://github.com/ihaiker/sudis/releases)

### æºç å®‰è£…

#### ä¸‹è½½æºä»£ç 

```shell script
git clone https://github.com/ihaiker/sudis.git
```

#### ç¼–è¯‘ç¨‹åºï¼ˆmakeæ–¹å¼ï¼‰

```shell script
cd sudis
make release
```
ç¼–è¯‘å®Œçš„ç¨‹åºåœ¨ å½“å‰æ–‡ä»¶å¤¹binç›®å½•ä¸‹ï¼Œç¼–è¯‘å®Œæˆã€‚

#### ç¼–è¯‘ç¨‹åº 

ç¬¬ä¸€æ­¥ï¼šç¼–è¯‘ç”Ÿæˆå‰ç«¯é¡µé¢ï¼ˆv3ç‰ˆå·²ç»ä¸Šä¼ ç¼–è¯‘ç»“æœï¼Œä¸ç”¨å†æ‰§è¡Œæ­¤éƒ¨åˆ†ï¼‰
```shell script
$ cd sudis/webui 
webui$ npm i -g @vue/cli #å®‰è£…vue cli
webui$ npm i #å®‰è£…ä¾èµ–
webui$ npm run build
```
> npmå®‰è£…ä¼šå¾ˆæ…¢ï¼Œå®‰è£…[cnpm](https://npm.taobao.org/)ä¼šå¾ˆå¿«ã€‚

ç¬¬äºŒæ­¥ï¼šä½¿ç”¨ go-bindata æŠŠé¡µé¢æ–‡ä»¶æ‰“åŒ…ã€‚

```shell script
$ go generate generator.go #æ‰§è¡Œæ­¤æ­¥éœ€è¦å®‰è£…go-bindata
```

ç¬¬ä¸‰æ­¥ï¼šä¸‹è½½goä¾èµ–åŒ…
```shell script
$ go mod download
```

ç¬¬å››æ­¥ï¼šç¼–è¯‘
```shell script
$ go build 
```

### ç¨‹åºé…ç½®
å¤åˆ¶`libs/config/sudis.example.yaml` åˆ° conf/sudis.yaml`
```yaml
#### æ˜¯å¦å·²debugæ¨¡å¼è¿è¡Œ
#debug: false

#### node èŠ‚ç‚¹å”¯ä¸€IDï¼Œä¸æŒ‡å®šå°†ä¼šè·å–hostname,å¦‚æœå¤šæœºå™¨ä¸‹hostnameé‡å¤éœ€è¦æ˜ç¡®æŒ‡å®š
#key: sudis


#### æ•°æ®å­˜å‚¨ä½ç½®ï¼Œ
# 1ã€å¦‚æœç”¨æœªæŒ‡å®šæ•°æ®å­˜å‚¨ä½ç½®ä¹Ÿæ²¡æœ‰è®¾ç½®é…ç½®æ–‡ä»¶ï¼Œæ•°æ®ä½ç½®ä¸º: $HOME/.sudis
# 2ã€å¦‚æœç”¨æˆ·è®¾ç½®äº†é…ç½®æ–‡ä»¶ï¼Œå•ä½è®¾ç½®æ•°æ®ä½ç½®ï¼Œé»˜è®¤ä¸º: dir(conf)
#data-path: $HOME/.sudis

#### OpenApi,WebAdmin å¼€æ”¾åœ°å€ï¼Œé»˜è®¤ä¸å¼€æ”¾
address: 127.0.0.1:5984

#### æ˜¯å¦ç¦ç”¨webç®¡ç†å°ï¼Œé»˜è®¤ä¸ç¦ç”¨ï¼Œæ­¤å‚æ•°åªæœ‰é…ç½®addressèµ·æ•ˆ
#disable-webui: false

#### æ•°æ®å­˜å‚¨é…ç½®
#database:
#  type: sqlite3
#  url: sudis.db


#### æ˜¯å¦å¼€å‘ç®¡ç†èŠ‚ç‚¹ï¼Œé»˜è®¤ä¸å¼€æ”¾
manager: 127.0.0.1:5983

#### å®‰å…¨åŠ å¯†ç›å€¼ï¼Œ
# 1ã€å¦‚æœè®¾ç½®äº†æ­¤å€¼ï¼Œæ‰€æœ‰èŠ‚ç‚¹åŠ å…¥ç®¡ç†çš„éªŒè¯å°†é»˜è®¤ä½¿ç”¨æ­¤å€¼
# 2ã€è‹¥æœªè®¾ç½®èŠ‚ç‚¹å°†ä½¿ç”¨å•ç‹¬çš„è®¾ç½®
#salt: whosyourdaddy


#### æ‰˜ç®¡åŠ å…¥åœ°å€ï¼Œé»˜è®¤ä¸åŠ å…¥ä»»ä½•åœ°å€
#join: []
#### or
#join:
# - 192.168.1.254:5983[,salt]
# - 192.168.1.253:5983[,salt]
## æ³¨æ„ å¦‚æœç›å€¼æœªè®¾ç½®ç»é»˜è®¤ä½¿ç”¨ salt ç›å€¼ï¼ˆæ²¡æœ‰æŠ¥é”™ï¼‰
## å¦‚æœå…¨å¹³å°ä½¿ç”¨ç›¸åŒçš„ç›å€¼ï¼Œå°±éœ€è¦æŠŠsaltè®¾ç½®ã€‚å¦‚æœä¸æ˜¯æ¯ä¸ªå•ç‹¬è®¾ç½®


#### ç¨‹åºé»˜è®¤ç­‰å¾…æ—¶é—´ï¼Œä¾‹å¦‚å…³é—­æ—¶é—´
#maxwait: 15s

```

## è¿è¡Œç¨‹åº

```she
$ sudis -f conf/sudis.yaml 
```



## é›†ç¾¤éƒ¨ç½²

é›†ç¾¤éƒ¨ç½²æ‰€æœ‰çš„é…ç½®æ–‡ä»¶ç±»ä¼¼ã€‚

> éƒ¨ç½²å‡†å¤‡ï¼Œä¸¤ç®¡ç†å¤šæ‰˜ç®¡

ä¸¤å°ç®¡ç†ç«¯ ï¼š 192.168.0.100 ,192.168.0.101ï¼Œ ä¸‰å°æ‰˜ç®¡æœºå™¨ï¼Œ192.168.0.102ï¼Œ192.168.0.103ï¼Œ192.168.0.104

ä¸»èŠ‚ç‚¹ç®¡ç†é…ç½®ï¼šï¼ˆæœ€ç®€åŒ–é…ç½®ï¼‰

```yaml
address: 0.0.0.0:5984
manager: 0.0.0.0:5983
salt: whosyourdaddy
```

æœºå™¨é…ç½®ï¼š(æœ€ç®€åŒ–é…ç½®)

```yaml
salt: whosyourdaddy ## æ³¨æ„ç›å€¼å¿…é¡»å’Œä¸»èŠ‚ç‚¹ä¸€è‡´
join:
	- 192.168.0.100:5983
	- 192.168.0.101:5983
```

æ³¨æ„ï¼šæ‰˜ç®¡é…ç½®ï¼Œæ²¡æœ‰æ‰“å¼€webuiç®¡ç†åŠŸèƒ½ï¼Œå¦‚æœéœ€è¦æ‰“å¼€åªéœ€é…ç½®`address`å³å¯ï¼Œä¸»èŠ‚ç‚¹è™½ç„¶å¯ä»¥å¤šä¸ªä½†æ˜¯å¹¶éä¸¥æ ¼æ„ä¹‰å•†çš„HAä¸»èŠ‚ç‚¹ï¼Œåªæ˜¯æœ‰å¤šä¸ªä¸»èŠ‚ç‚¹è€Œå·²ï¼Œä¸å»ºè®®ä½¿ç”¨nginxç›´æ¥ä»£ç†ï¼ˆæŸ¥çœ‹æ—¥å¿—ä¼šå‡ºç°é—®é¢˜ï¼‰



## è¿›å…¥ç®¡ç†

### webui ç®¡ç†ï¼ˆéœ€è¦é…ç½®å¼€å¯ï¼‰

webuié»˜è®¤åœ°å€ï¼š è¶…çº§ç®¡ç†å‘˜é»˜è®¤å¯†ç ä¸ºï¼šadmin:12345678

```
http://localhost:5984
```

å…³äºé€šçŸ¥é…ç½®ï¼šè¯·æŸ¥è¯¢ [é€šçŸ¥é…ç½®](./NOTIFY.md)



### cli å‘½ä»¤è¡Œç®¡ç†

ç¨‹åºå¯åŠ¨å‚æ•°å’Œå‘½ä»¤å¯ä»¥é€šè¿‡ -h å¸®åŠ©æ–¹å¼æŸ¥è¯¢ä¾‹å¦‚ï¼š

```shell
$ ./bin/sudis cli -h
SUDIS V3, ä¸€ä¸ªåˆ†å¸ƒå¼è¿›ç¨‹æ§åˆ¶ç¨‹åºã€‚

Usage:
  sudis console [command]

Aliases:
  console, cli

Available Commands:
  add         æ·»åŠ ç¨‹åºç®¡ç†
  delete      åˆ é™¤ç®¡ç†çš„ç¨‹åº
  detail      æŸ¥çœ‹é…ç½®ä¿¡æ¯ï¼ŒJSON
  join        åŠ å…¥ä¸»æ§èŠ‚ç‚¹
  list        æŸ¥çœ‹ç¨‹åºåˆ—è¡¨
  modify      ä¿®æ”¹ç¨‹åº
  start       å¯åŠ¨ç®¡ç†çš„ç¨‹åº
  status      æŸ¥çœ‹è¿è¡ŒçŠ¶æ€
  stop        åœæ­¢ç®¡ç†çš„ç¨‹åº
  tag         æ·»åŠ ç¨‹åºæ ‡ç­¾
  tail        æŸ¥çœ‹æ—¥å¿—

Flags:
  -h, --help               help for console
  -k, --node string        æ‰§è¡Œçš„èŠ‚ç‚¹
  -s, --sock string        è¿æ¥æœåŠ¡ç«¯sockåœ°å€.(default: ${data-path}/sudis.sock)
  -t, --timeout duration   wait timeout (default 15s)
```

